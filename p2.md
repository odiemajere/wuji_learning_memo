# 无线门磁探测器视频课 1

## 电子产品项目开发流程

```
项目开发需求 -> 项目技术预研 -> 产品项目立项 -> 项目产品开发 -> 研发样品验收 -> 小批量试产 -> 结案
```

项目立项：

    - 成本评估：BOM，单品成本，开发物料成本，人工成本，时间成本
    - 开发周期评估：开发周期，开发阶段性成果要求
    - 风险评估：技术风险，认证风险
    - 开发团队的组建：硬件，软件，测试，结构，UI工程师等
    - .......

## 门磁探测器简单介绍

### 门磁探测器是定义

用来探测门、窗、抽屉等是否被非法打开或移动的报警器

### 门磁产品的分类：

    - 有线门磁：485通讯/开关信号
    - 无线门磁：ASK  FSK  蓝牙 WIFI NB-IotLora 等
    - 独立门磁:  现场报警提示

### 门磁组成：

    - 门磁主体
    - 永磁铁

## 门磁项目培训主要内容

1. 无线门磁产品介绍和应用场景说明
2. 无线门磁探测器项目品需求
3. 无线门磁探测器硬件设计
4. 无线门磁探测器软件设计
5. 无线门磁探测器产品验收

## 门磁探测器开发需求

### 供电及电源

|    Syntax    | Description |
| :----------: | :---------- |
|   供电方式   | 干电池      |
|     型号     | 23A         |
|   供电电压   | 12V         |
|   待机电流   | <5uA        |
| 无线发射电流 | <15mA       |

### 无线参数

|    Syntax    | Description                            |
| :----------: | :------------------------------------- |
|   编码方式   | ASK（OOK）                             |
|   无线地址   | 20bit                                  |
|    功能码    | 4bit                                   |
|   震荡电阻   | 330K 可定制                            |
| 无线发射距离 | 空旷 > 120 m                           |
| EV1527 编码  | 内置兼容                               |
| PT2262 编码  | 需定制开发                             |
|   发射频率   | 433.92MHZ<br>（可选 315MHZ,868.32MHZ） |
|   编码方式   | MCU 内部编码                           |

### 主要功能和上报数据说明

|      Syntax      | Description    |     |
| :--------------: | :------------- | :-: |
|   开门数据上报   | 支持           | 5H  |
|   关门数据上报   | 支持（可关闭） | 6H  |
| 电池低压数据上报 | 支持（可关闭） | 7H  |

1. 23A 电池供电 12V
2. 通讯方式：433.92MHZ ASK 编码
3. 编码数据要求：兼容 ev1527
4. 配套安防主机使用
5. 开关门状态上报
6. 电池低压提示功能
7. 公模

# 无线门磁探测器视频课 2

## 硬件设计流程

硬件设计流程

```
项目开发需求 -> 外壳设计确定 -> 关键物料选型 -> 原理图绘制 -> PCB板绘制 -> 软件开发调试 -> 产品测试验证 -> 完成
```

## 关键物料选型

|    关键物料     | 单价（元） |
| :-------------: | :--------: |
| MCU STC15KF104W |    1.2     |
|     干簧管      |    0.4     |
|     HT7530      |    0.5     |
|      外壳       |    1.5     |
|    其他物料     |     1      |
|     加工费      |     /      |
|      合计       |    14.6    |

干簧管：磁簧开关(Reed Switch)也称之为干簧管，它是一个通过所施加的磁场操作的电开关。基本型式是将两片磁簧片密封在玻璃管内，两片虽重叠，但中间间隔有一小空隙。当外来磁场时将使两片磁簧片接触，进而导通。 一旦磁体被拉到远离开关，磁簧开关将返回到其原来的位置

## AD 软件介绍

## 原理图绘制

# 无线门磁探测器视频课 3-1

## AD 软件介绍

    1. 原理图设计
    2. 印刷电路板设计
    3. 嵌入式开发
    4. 3D PCB设计
    5. 封装库设计

## AD 新建 PCB 工程流程

    1. file->new->project->PCB project
    2. 右键点击新建的工程->save project
    3. 设置工程存储路径
    4. 右键点击新建的工程->add new to project->Schematic
    5. 右键点击新建的工程->add new to project->PCB
    6. 右键点击新建的Schematic和PCB，分别设置存储路径并命名存储
    7. 还可以根据需要添加原理图库Schematic library和电路板库PCB library
    8. 右键点击新建的工程->add new to project->Schematic Library
    9. 右键点击新建的工程->add new to project->PCB library

# 无线门磁探测器视频课 3-2 3-3 3-4

## 按需求制作各功能原理图

绘制原理图操作注意

1. 点选元器件，按<font color=Magenta>空格键</font>逆时针旋转 90°
2. <font color=Magenta>pp</font>热键放置针脚（Place Pin），放置前按 tab 键编辑针脚名称及序号等
3. Place->Text String 在原理图中添加文字

## 无线门磁探测器项目干簧管部分电路

![doorsensor_reed](https://s3.bmp.ovh/imgs/2022/03/4de12bfa9bb99e5f.png)

1. 关门->干簧管导通->KAI 端悬空（此处设置为悬空，按图所示为拉高）->GUAN 拉低
2. 开门->干簧管断开->KAI 拉低->GUAN 拉高

## 无线门磁探测器项目电池供电部分电路

![doorsensor_battery](https://s3.bmp.ovh/imgs/2022/03/c9efccbea550d015.png)

1. HT7530 可以读数据手册
2. 接地端连一个电容防止反向电流

## 无线门磁探测器项目电量检测部分电路

![doorsensor_Low_Power_Test](https://s3.bmp.ovh/imgs/2022/03/31cd31d77b14ce93.png)

1. 电量充足时->battery12V->A 点分压电路约为 1.5v->Q3 导通->Q2 断开->Volt 拉高
2. 电量不足时->battery9V->A 点分压电路约为 1.17v->Q3 断开->Q2 导通->Volt 拉低

## 无线门磁探测器项目射频部分电路

![doorsensor_RF](https://s3.bmp.ovh/imgs/2022/03/9eb4a445033ac9db.png)

1. 晶振提供一个 433.92Mhz 的载波频率
2. 数据通过 ASK_SentData 发送
3. C2 的规格根据电路板的情况调整

# 无线门磁探测器视频课 3-5 3-6 3-7

![STC1510X系列烧录方法](https://s3.bmp.ovh/imgs/2022/03/33964ac91ceac5b4.png)

## 无线门磁探测器项目 MCU 部分电路

![doorsensor_MCU](https://s3.bmp.ovh/imgs/2022/03/36629335d7e39945.png)

## 注意事项

1. 供给 MCU 的电源一般接一个电容再接入 Vcc
2. 根据电量检测电路，电量检测需要一个下降沿触发的中断
3. 干簧管部分根据电路，开门时 KAI 端下降沿触发
4. 关门时 GUAN 端下降沿触发
5. 射频 ASK_SentData 需要一个外部中断
6. 工作指示灯，低电压指示灯复用两个 IO
7. Tools->Annotate Schematics 顺序执行下列操作
   - Reset All
   - Update Changes List
   - Accept Changes (Create ECO)
     - V Changes
     - Execute Changes
